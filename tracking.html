<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <link rel="stylesheet" href="assets/sweetalert2/sweetalert2.min.css" rel="stylesheet">
        <link rel="stylesheet" href="assets/datatables/css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" href="assets/datatables/css/select.bootstrap4.min.css">
        <link rel="stylesheet" href="assets/datatables/css/buttons.bootstrap4.min.css">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="assets/select2/css/select2.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="assets/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css">

        <!-- Fontawesome -->
        <script src="https://kit.fontawesome.com/7a4dfbbce0.js" crossorigin="anonymous"></script>
        <!-- Datepicker -->
        <link rel="stylesheet" href="assets/bootstrap-datepicker/css/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="assets/images/crowns.ico">

        <title>API Aplication</title>
    </head>
    <body>
        
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="/">My Apps</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item ">
                        <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" id="ongkir" href="cek_ongkir.html">Cek Ongkir </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" id="tracking" href="tracking.html">Cek Pengiriman </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="sholat" href="sholat.html">Cek Waktu Sholat </a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container">
            <div class="content" id="content">

                <div class="card mt-5 mb-5">
                    <div class="card-header">
                        <b>Cek Pengiriman</b>
                        <button type="button" class="btn btn-primary float-right" id="btn_refresh"><i class="fas fa-sync"></i> Refresh</button>
                    </div>
                    <div class="card-body table-responsive">
                        <!-- <form action="" id="cek_ongkir" class=""> -->

                            <div class="row">
                                <div class="col-lg-6 col-sm-12 col-md-12 form-group row">
                                    <label class="col-4 col-form-label">Nomor Resi </label>
                                    <div class="col-8">
                                        <input type="text" class="form-control" name="waybill" id="waybill" placeholder="Nomor Resi">
                                    </div>
                                </div>

                                <div class="col-lg-6 col-sm-12 col-md-12 form-group row">
                                    <label class="col-4 col-form-label">Kurir</label>
                                    <div class="col-8">
                                        <select name='courier' class=' form-control' id="courier">
                                            <option class="text-dark" value="">-- Pilih --</option>
                                            <option class="text-dark" value="jne">JNE</option>
                                            <option class="text-dark" value="pos">POS Indonesia</option>
                                            <option class="text-dark" value="tiki">TIKI</option>
                                            <option class="text-dark" value="wahana">WAHANA</option>
                                            <option class="text-dark" value="sicepat">SICEPAT</option>
                                            <option class="text-dark" value="ninja">Ninja Xpress</option>
                                            <option class="text-dark" value="lion">Lion Parcel</option>
                                            <option class="text-dark" value="jet">JET Express (JET)</option>
                                            <option class="text-dark" value="pahala">Pahala Kencana Express (PAHALA)</option>
                                            <option class="text-dark" value="sap">SAP Express (SAP)</option>
                                            <option class="text-dark" value="star">Star Cargo (STAR)</option>
                                            <option class="text-dark" value="pcp">Priority Cargo and Package (PCP)</option>
                                            <option class="text-dark" value="esl">Eka Sari Lorena (ESL)</option>
                                            <option class="text-dark" value="rpx">RPX Holding (RPX)</option>
                                            <option class="text-dark" value="pandu">Pandu Logistics (PANDU)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                            	<div class="col-md-12 form-group row">
                            		<div class="col-md-12">
                            			<button type="button" class="btn btn-success float-right mr-4" id="btn_submit"><i class="fas fa-search"></i> Cari</button>
                            		</div>
                            	</div>
                            </div>
                        <!-- </form> -->
                    </div>
                </div>

				<div id="table-tracking">
					
				</div>
            </div>
        </div>

        <nav class="navbar fixed-bottom navbar-dark bg-dark">
            <div class="col-12">  
                <small class="text-light">Â©mr.guh - 2020</small>
            </div>
        </nav>

        <<script type="text/javascript" src="assets/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript" src="assets/select2/js/select2.min.js"></script>
        <script type="text/javascript" src="assets/sweetalert2/sweetalert2.min.js"></script>
        
        <!-- Data tables -->
        <script type="text/javascript" src="assets/datatables/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="assets/datatables/js/dataTables.bootstrap4.min.js"></script>
        <!-- Datepicker -->
        <script type="text/javascript" src="assets/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>


        <!-- JAVASCRIPT -->
        <script type="text/javascript" src="config.js"></script>
        <script type="text/javascript">

            $(function() {

                $('#btn_refresh').on('click', function () {
                    onClear()
                })

                $('#btn_submit').on('click', function () {
                    cari()
                })
            });

            function onClear () {
                $('#waybill').val('')
                $('#courier').val('')

				$('#table-tracking').empty();
            }

            function cari () {
                if ($('#waybill').val() != '' && $('#courier').val()) {
                    $.ajax({
                        url: "https://belserion.000webhostapp.com/tracking_api.php",
                        type: "POST",
                        dataType: "JSON",
                        crossDomain: true,
                        data: {
                            waybill: $('#waybill').val(),
                            courier: $('#courier').val(),

                        },
                        success: function (r) {
                            var html 	= ''
                            var tr 		= ''
                            var data 	= r.data

                            if(r.status){
                            	var manifest 	= data.manifest
                            	var color 		= ''

                                manifest.forEach( function(v, i) {
                                    tr += '<tr>' +
                                            '<td scope="row">'+ GetFormattedDate(v.manifest_date) +' '+ v.manifest_time +'</td>' +
                                            '<td scope="row">'+ v.city_name +'</td>' +
                                            '<td scope="row">'+ v.manifest_description +'</td>' +
                                        '</tr>';
                                });

                                if (data.delivered) {
                                	color = '#36a832 !important'
                                } else {
                                	color = '#fa7900 !important;'
                                }

                                html += '<div class="card mt-5 mb-5">' +
	                                        '<div class="card-header">' +
	                                        	'<div class="col-12">' +
	                                            	'<h4><b>Hasil pelacakan paket </b></h4><br>' + 
	                                            	'<b class="">'+ $('#waybill').val() +'(' + $('#courier option:selected').text() + ')</b>' + 
	                                        	'</div>' +
	                                        '</div>' +
	                                        '<div class="card-body table-responsive">' +
	                                        	'<div class="alert alert-warning text-center" style="background-color: '+ color +' " role="alert">' +
												  	'<strong class="text-light">'+ data.summary.status +'</strong>' +
												'</div>' +
	                                            '<table class="table table-hover" id="tb_jasa_ongkir">' +
	                                                '<tbody>' +
	                                                    '<tr>' +
	                                                      '<th scope="col" width="50%">Nomor Resi</th>' +
	                                                      '<td scope="col">'+ data.summary.waybill_number +'</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Kurir Pengiriman</th>' +
	                                                      '<td scope="col">' + data.summary.courier_name + '</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Jenis Layanan</th>' +
	                                                      '<td scope="col">'+ data.summary.service_code +'</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Tanggal Pengiriman</th>' +
	                                                      '<td scope="col">'+ GetFormattedDate(data.details.waybill_date) +' '+ data.details.waybill_time +'</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Berat Kiriman</th>' +
	                                                      '<td scope="col">'+ data.details.weight +' kg</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Nama Pengirim</th>' +
	                                                      '<td scope="col">'+ data.details.shippper_name +'</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Kota Asal Pengirim</th>' +
	                                                      '<td scope="col">'+ data.details.origin +'</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Nama Penerima</th>' +
	                                                      '<td scope="col">'+ data.details.receiver_name +'</td>' +
	                                                    '</tr>' +
	                                                    '<tr>' +
	                                                      '<th scope="col">Alamat Penerima</th>' +
	                                                      '<td scope="col">'+ data.details.receiver_address1 + ' ' + data.details.receiver_address2 + ' ' + data.details.receiver_address3 + ' ' +'</td>' +
	                                                    '</tr>' +
	                                                '</tbody>' +
	                                            '</table>' +
	                                        '</div>' +
	                                    '</div>' +
	                                    '<div class="card mt-5 mb-5">' +
	                                        '<div class="card-header">' +
	                                            '<b>Riwayat Pengiriman</b>' +
	                                        '</div>' +
	                                        '<div class="card-body table-responsive">' +
	                                            '<table class="table table-striped table-hover" id="tb_jasa_ongkir">' +
	                                                '<thead>' +
	                                                    '<tr>' +
	                                                      '<th scope="col" class="text-center">Tanggal</th>' +
	                                                      '<th scope="col" class="text-center">Kota</th>' +
	                                                      '<th scope="col" class="text-center">Keterangan</th>' +
	                                                    '</tr>' +
	                                                '</thead>' +
	                                                '<tbody>' +
	                                                    tr +
	                                                '</tbody>' +
	                                            '</table>' +
	                                        '</div>' +
	                                    '</div>';

                                $('#table-tracking').empty();
                                $('#table-tracking').append(html);
                            }else{
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: data.pesan,
                                })
                            }
                        }
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Silahkan lengkapi parameter diatas!',
                    })
                }
            }

        </script>
    </body>
</html>